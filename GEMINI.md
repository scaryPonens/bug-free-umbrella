## Startup Instructions

**IMPORTANT:** At the beginning of every new chat session, you MUST read the full content of the `PLAN.md` file to understand the current project goals, completed phases, and future work. This plan is the primary source of truth for the project's direction.

# Gemini Project Context: bug-free-umbrella

This document provides a comprehensive overview of the `bug-free-umbrella` project for the Gemini AI agent.

## Project Overview

`bug-free-umbrella` is a sophisticated, Go-based crypto trading advisor bot. Its primary function is to track live cryptocurrency prices, analyze market data, generate trading signals, and expose this information through multiple interfaces.

The system is composed of several key components:
*   A **Gin-based web API** for serving price data, candles, and signals, with API documentation generated by Swagger.
*   A **PostgreSQL database** for persisting OHLCV (Open, High, Low, Close, Volume) candles, trading signals, and other market intelligence data.
*   A **Redis cache** for fast access to the latest price information.
*   **Background polling jobs** that fetch data from external sources like CoinGecko and internal jobs for signal generation and data maintenance.
*   An **MCP (Multi-Capability Plan) service** that exposes project data and tools through a structured, streamable interface, compatible with local agent tooling.
*   A **Telegram bot** for interactive queries on prices, signals, and alerts.
*   **Machine Learning models** for advanced signal generation, including an ensemble model and anomaly detection.
*   **Fundamentals and sentiment analysis** to create composite signals from sources like news feeds, Reddit, and on-chain metrics.
*   **OpenTelemetry integration** for distributed tracing with Jaeger, providing observability into the system.

## Key Technologies

*   **Backend:** Go
*   **API Framework:** Gin
*   **Database:** PostgreSQL
*   **Cache:** Redis
*   **Containerization:** Docker, Docker Compose
*   **Observability:** OpenTelemetry, Jaeger
*   **API Documentation:** Swagger (via Swag)

## How to Run the Project

The project is designed to be run using Docker Compose, which orchestrates all the necessary services.

1.  **Configure Environment:**
    *   Copy the `.env.example` file to `.env`.
    *   Fill in the necessary secrets, especially `TELEGRAM_BOT_TOKEN`.

2.  **Run Database Migrations:**
    *   The database schema must be initialized before the main application starts.
    *   Command: `docker compose --env-file .env run --rm app ./migrate up`

3.  **Start All Services:**
    *   This command builds the Go application and starts the API, database, cache, and tracing services.
    *   Command: `docker compose --env-file .env up --build`

4.  **Accessing Services:**
    *   **API:** `http://localhost:8080`
    *   **Swagger UI:** `http://localhost:8080/swagger/index.html`
    *   **Jaeger UI:** `http://localhost:16686`

## Common Development Tasks

Here are the essential commands for development and maintenance:

*   **Running Unit Tests:**
    *   Execute the full test suite and generate a coverage report.
    *   Command: `go test ./... -coverprofile=coverage.out`

*   **Managing Database Migrations:**
    *   Run locally without Docker.
    *   Apply migrations: `go run ./cmd/migrate up`
    *   Rollback migrations: `go run ./cmd/migrate down`

*   **Generating API Documentation:**
    *   After changing API handlers or their annotations, regenerate the Swagger documentation.
    *   Command: `swag init -g cmd/server/main.go`

*   **Running the MCP Service Locally:**
    *   For testing agent integrations.
    *   Command: `MCP_TRANSPORT=stdio go run ./cmd/mcp`

*   **Backfilling ML Data:**
    *   Populate historical candle data required for training ML models.
    *   Command: `go run ./cmd/mlbackfill`

## Project Structure

```
cmd/server/            Entrypoint and dependency wiring
cmd/mcp/               MCP server binary (stdio + HTTP)
cmd/migrate/           Versioned Postgres schema migrations runner
internal/bot/          Telegram bot commands
internal/cache/        Redis client initialization
internal/chart/        Go-native signal chart image rendering
internal/config/       Environment variable loading
internal/db/           Postgres connection pool
internal/domain/       Domain types (Candle, PriceSnapshot, Asset, Signal)
internal/handler/      HTTP handlers with Swagger annotations
internal/job/          Background jobs (price/signal pollers + signal-image maintenance)
internal/provider/     External API clients (CoinGecko) and rate limiter
internal/repository/   Postgres persistence (candle repository, migrations)
internal/signal/       Pure technical-analysis signal engine (RSI/MACD/Bollinger/Volume)
internal/service/      Business logic (price service, signal service, work service)
internal/mcp/          MCP tools/resources, transport auth, and middleware
internal/marketintel/  Fundamentals/sentiment ingestion, scoring, and composite signal logic
pkg/tracing/           OpenTelemetry initialization
docs/                  Generated Swagger spec (do not edit manually)
```
